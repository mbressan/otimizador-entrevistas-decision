<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otimizador de Entrevistas - Predi√ß√£o</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .result-card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .percentage-display {
            font-size: 3rem;
            font-weight: bold;
        }
        .high-quality {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        .low-quality {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
        }
        .analysis-item {
            border-left: 4px solid #007bff;
            padding-left: 15px;
            margin-bottom: 10px;
        }
        .loading {
            display: none;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-primary">
        <div class="container">
            <span class="navbar-brand mb-0 h1">üéØ Otimizador de Entrevistas</span>
            <div class="navbar-nav">
                <a class="nav-link" href="/status">Status</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üìÑ Informa√ß√µes da Vaga</h5>
                    </div>
                    <div class="card-body">
                        <form id="predictionForm">
                            <div class="mb-3">
                                <label for="titulo_vaga" class="form-label">T√≠tulo da Vaga *</label>
                                <input type="text" class="form-control" id="titulo_vaga" name="titulo_vaga" required
                                       placeholder="Ex: Desenvolvedor Python S√™nior">
                            </div>
                            
                            <div class="mb-3">
                                <label for="competencias_tecnicas" class="form-label">Compet√™ncias T√©cnicas Requeridas *</label>
                                <textarea class="form-control" id="competencias_tecnicas" name="competencias_tecnicas" rows="3" required
                                          placeholder="Ex: Python, Django, FastAPI, PostgreSQL, Docker, AWS"></textarea>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="nivel_academico_vaga" class="form-label">N√≠vel Acad√™mico</label>
                                        <select class="form-select" id="nivel_academico_vaga" name="nivel_academico">
                                            <option value="">Selecione...</option>
                                            <option value="m√©dio">Ensino M√©dio</option>
                                            <option value="t√©cnico">T√©cnico</option>
                                            <option value="superior">Superior</option>
                                            <option value="p√≥s">P√≥s-gradua√ß√£o</option>
                                            <option value="mestrado">Mestrado</option>
                                            <option value="doutorado">Doutorado</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="nivel_ingles_vaga" class="form-label">N√≠vel de Ingl√™s</label>
                                        <select class="form-select" id="nivel_ingles_vaga" name="nivel_ingles">
                                            <option value="">Selecione...</option>
                                            <option value="b√°sico">B√°sico</option>
                                            <option value="intermedi√°rio">Intermedi√°rio</option>
                                            <option value="avan√ßado">Avan√ßado</option>
                                            <option value="fluente">Fluente</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="nivel_profissional" class="form-label">N√≠vel Profissional</label>
                                        <select class="form-select" id="nivel_profissional" name="nivel_profissional">
                                            <option value="">Selecione...</option>
                                            <option value="j√∫nior">J√∫nior</option>
                                            <option value="pleno">Pleno</option>
                                            <option value="s√™nior">S√™nior</option>
                                            <option value="especialista">Especialista</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="tipo_contratacao" class="form-label">Tipo de Contrata√ß√£o</label>
                                        <select class="form-select" id="tipo_contratacao" name="tipo_contratacao">
                                            <option value="">Selecione...</option>
                                            <option value="clt">CLT</option>
                                            <option value="pj">PJ</option>
                                            <option value="tempor√°rio">Tempor√°rio</option>
                                            <option value="est√°gio">Est√°gio</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="areas_atuacao" class="form-label">√Åreas de Atua√ß√£o</label>
                                <input type="text" class="form-control" id="areas_atuacao" name="areas_atuacao"
                                       placeholder="Ex: Tecnologia, TI, Desenvolvimento">
                            </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">üë§ Dados do Candidato</h5>
                    </div>
                    <div class="card-body">
                            <div class="mb-3">
                                <label for="conhecimentos_tecnicos" class="form-label">Conhecimentos T√©cnicos *</label>
                                <textarea class="form-control" id="conhecimentos_tecnicos" name="conhecimentos_tecnicos" rows="3" required
                                          placeholder="Ex: Python, JavaScript, React, Node.js, MongoDB"></textarea>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="nivel_academico_candidato" class="form-label">N√≠vel Acad√™mico</label>
                                        <select class="form-select" id="nivel_academico_candidato" name="nivel_academico_candidato">
                                            <option value="">Selecione...</option>
                                            <option value="m√©dio">Ensino M√©dio</option>
                                            <option value="t√©cnico">T√©cnico</option>
                                            <option value="superior">Superior</option>
                                            <option value="p√≥s">P√≥s-gradua√ß√£o</option>
                                            <option value="mestrado">Mestrado</option>
                                            <option value="doutorado">Doutorado</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="nivel_ingles_candidato" class="form-label">N√≠vel de Ingl√™s</label>
                                        <select class="form-select" id="nivel_ingles_candidato" name="nivel_ingles_candidato">
                                            <option value="">Selecione...</option>
                                            <option value="b√°sico">B√°sico</option>
                                            <option value="intermedi√°rio">Intermedi√°rio</option>
                                            <option value="avan√ßado">Avan√ßado</option>
                                            <option value="fluente">Fluente</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="area_atuacao_candidato" class="form-label">√Årea de Atua√ß√£o *</label>
                                <input type="text" class="form-control" id="area_atuacao_candidato" name="area_atuacao_candidato" required
                                       placeholder="Ex: Desenvolvimento de Software, TI, Tecnologia">
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" id="submitButton" class="btn btn-primary btn-lg">
                                    <span class="spinner-border spinner-border-sm me-2 loading" role="status" style="display: none;"></span>
                                    üéØ Analisar Compatibilidade
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resultado da Predi√ß√£o -->
        <div class="row mt-4" id="resultSection" style="display: none;">
            <div class="col-12">
                <div class="card result-card" id="resultCard">
                    <div class="card-header text-white">
                        <h4 class="mb-0">üìä Resultado da An√°lise</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 text-center">
                                <div class="percentage-display" id="percentageDisplay">---%</div>
                                <h5 id="qualityText">Calculando...</h5>
                            </div>
                            <div class="col-md-8">
                                <h6>üìà An√°lise Detalhada:</h6>
                                <div id="analysisDetails"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Verificar se o DOM est√° carregado
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up form listener...');
            
            var form = document.getElementById('predictionForm');
            if (!form) {
                console.error('Form not found!');
                return;
            }
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('Form submitted!');
                
                // Tentar encontrar o bot√£o de v√°rias formas
                var submitBtn = form.querySelector('button[type="submit"]') || 
                               document.querySelector('button[type="submit"]') ||
                               document.getElementById('submitButton');
                
                console.log('Submit button found:', submitBtn);
                
                if (!submitBtn) {
                    console.error('Submit button not found! Continuing without loading animation...');
                }
                
                var loading = null;
                if (submitBtn) {
                    loading = submitBtn.querySelector('.loading');
                    if (loading) {
                        loading.style.display = 'inline-block';
                    }
                    submitBtn.disabled = true;
                }
                
                // Coletar dados do formul√°rio
                var formData = new FormData(form);
                var data = {
                    vaga: {
                        titulo_vaga: formData.get('titulo_vaga') || '',
                        competencias_tecnicas_requeridas: formData.get('competencias_tecnicas') || '',
                        nivel_academico: formData.get('nivel_academico') || '',
                        nivel_ingles: formData.get('nivel_ingles') || '',
                        nivel_profissional: formData.get('nivel_profissional') || '',
                        tipo_contratacao: formData.get('tipo_contratacao') || '',
                        areas_atuacao: formData.get('areas_atuacao') || ''
                    },
                    candidato: {
                        conhecimentos_tecnicos: formData.get('conhecimentos_tecnicos') || '',
                        nivel_academico: formData.get('nivel_academico_candidato') || '',
                        nivel_ingles: formData.get('nivel_ingles_candidato') || '',
                        area_de_atuacao: formData.get('area_atuacao_candidato') || ''
                    }
                };
                
                console.log('Data to send:', data);
                
                // Fazer requisi√ß√£o
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/api/predict_simple', true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        // Esconder loading
                        if (loading) {
                            loading.style.display = 'none';
                        }
                        if (submitBtn) {
                            submitBtn.disabled = false;
                        }
                        
                        if (xhr.status === 200) {
                            try {
                                var result = JSON.parse(xhr.responseText);
                                console.log('API Response:', result);
                                displayResult(result);
                            } catch (e) {
                                console.error('Parse error:', e);
                                alert('Erro ao processar resposta do servidor');
                            }
                        } else {
                            console.error('HTTP Error:', xhr.status, xhr.responseText);
                            alert('Erro na comunica√ß√£o: ' + xhr.status);
                        }
                    }
                };
                
                xhr.onerror = function() {
                    console.error('Network error');
                    if (loading) {
                        loading.style.display = 'none';
                    }
                    if (submitBtn) {
                        submitBtn.disabled = false;
                    }
                    alert('Erro de conex√£o');
                };
                
                xhr.send(JSON.stringify(data));
            });
        });
        
        function displayResult(result) {
            console.log('Displaying result:', result);
            
            var resultSection = document.getElementById('resultSection');
            var resultCard = document.getElementById('resultCard');
            var percentageDisplay = document.getElementById('percentageDisplay');
            var qualityText = document.getElementById('qualityText');
            var analysisDetails = document.getElementById('analysisDetails');
            
            if (!resultSection) {
                console.error('resultSection not found!');
                alert('Erro: Se√ß√£o de resultado n√£o encontrada');
                return;
            }
            
            // Mostrar se√ß√£o de resultado
            resultSection.style.display = 'block';
            
            // Configurar cor do card
            var isHighQuality = result.prediction === 1;
            if (resultCard) {
                resultCard.className = 'card result-card ' + (isHighQuality ? 'high-quality' : 'low-quality');
            }
            
            // Mostrar porcentagem
            if (percentageDisplay) {
                percentageDisplay.textContent = result.percentage || '0%';
            }
            if (qualityText) {
                qualityText.textContent = result.prediction_text || 'Resultado';
            }
            
            // Mostrar an√°lise detalhada
            if (analysisDetails && result.analysis) {
                var analysis = result.analysis;
                analysisDetails.innerHTML = 
                    '<div class="analysis-item"><strong>üíª Compatibilidade T√©cnica:</strong> ' + (analysis.tech_compatibility || 'N/A') + '</div>' +
                    '<div class="analysis-item"><strong>üéì Compatibilidade Acad√™mica:</strong> ' + (analysis.academic_compatibility || 'N/A') + '</div>' +
                    '<div class="analysis-item"><strong>üåê Compatibilidade de Ingl√™s:</strong> ' + (analysis.english_compatibility || 'N/A') + '</div>' +
                    '<div class="analysis-item"><strong>üè¢ √Årea de Atua√ß√£o:</strong> ' + (analysis.area_match || 'N/A') + '</div>' +
                    '<div class="analysis-item"><strong>üìã Tipo de Contrato:</strong> ' + (analysis.contract_type || 'N/A') + '</div>';
            }
            
            // Scroll para o resultado
            resultSection.scrollIntoView({ behavior: 'smooth' });
            console.log('Result displayed successfully!');
        }
    </script>
</body>
</html>
